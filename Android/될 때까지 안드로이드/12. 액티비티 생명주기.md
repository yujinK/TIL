### 12. 액티비티 생명주기

#### 12.1 여러 액티비티의 관리

액티비티가 여러 개인 앱을 실행할 때 각 액티비티는 스택에 쌓임

액티비티를 관리하는 스택 = 액티비티 백스택(activity back stack)



#### 12.2 액티비티 생성주기 소개

- 액티비티가 생성될 때
  - onCreate() -> onStart() -> onResume()
  - onCreate() 메서드에서 앱의 초기화 등 수행
- 화면이 보이지 않을 때
  - onPause() -> onStop()
- 다시 앱으로 재진입할 때
  - onRestart() -> onStart() -> onResume()
- 종료할 때
  - onDestroy()
  - onDestroy() 메서드에서 리소스 해제 등 수행
- 액티비티의 전체 수명은 onCreate() ~ onDestroy()



#### 12.3 생명주기 콜백 메서드

​	~ 액티비티 실행 ~

- onCreate() : 객체 생성, 초기화 / 액티비티가 시작될 때

- onStart() : 화면이 보일 때 처리 / 액티비티가 보이기 직전

- onResume() : 화면이 보일 때 처리 / 액티비티가 완전히 보일 때

  ~ 액티비티 실행 중 ~

- onPause() : 화면이 안 보일 때 처리 / 액티비티가 포커스를 잃을 때

- onStop() : 화면이 안 보일 때 처리 / 액티비티가 완전히 보이지 않을 때

- onDestroy() : 메모리 해제 / 액티비티가 종료되기 직전

  ~ 액티비티 소멸 ~



**12.3.1 일시 정지 및 재개**

액티비티는 여러 가지 요인으로 일시 정지와 재개를 반복

ex.) 액티비티에서 다이얼로그 띄울 때

​	다이얼로그 포커스 이동 : 액티비티 일시 정지(onPause)

​	다이얼로그가 닫히고 액티비티가 다시 포커스를 가져감 : 액티비티 재개(onResume)



**12.3.2 정지 및 재실행**

앱이 완전히 화면에서 사라졌다가 다시 실행되는 경우

ex.) 홈 키를 누르거나 앱 사용 도중에 전화가 오는 등

​	화면에서 액티비티가 완전히 사라질 때 : onPause() -> onStop()

​	다시 실행될 때 : onRestart() -> onStart() -> onResume()

​				※ onRestart()는 재실행될 때만 호출되는 콜백 메서드



**12.3.3. 강제 종료 및 실행**

일시 정지 상태에서 오랫동안 사용되지 않는 앱은 시스템이 강제로 종료할 수 있음

onDestroy() 메서드 호출 X

강제 종료된 앱은 onCreate() 메서드부터 다시 시작



#### 12.4 화면 회전에도 끄떡없게 만들기

일반적으로 액티비티가 일시중지(onPause)되거나 중단(onStop)되더라도 액티비티의 상태(각종 변수)는 그대로 유지

∵ 액티비티의 상태가 메모리에 모두 저장

- 액티비티가 종료되는 상황
  - 뒤로 가기 키를 눌러서 종료
  - finish() 메서드 호출로 종료
  - 시스템에 의해 종료
    - 홈 키를 눌러 화면에 보이지 않는 상태로 장시간 경과한 때
    - 화면을 회전할 때
-  시스템이 액티비티를 강제로 종료하면 액티비티의 상태 유지 X
  - onSaveInstanceState()
    - 액티비티의 상태 정보를 Bundle이라는 객체에 저장
    - onDestroy() 메서드가 호출되기 전에 호출
    - onPause()와 onStop() 사이에 항상 호출
  - onRestoreInstanceState() 
    - Bundle 객체에 저장된 상태 정보 복원
    - onCreate() 메서드가 호출된 직후에 호출
    - 강제 종료되었을 때만 호출



**12.4.1 화면 회전 시 초기화되는 상태**

기본적으로 시스템은 Bundle 인스턴스 상태를 사용하여 액티비티 레이아웃의 각 뷰의 정보를 자동으로 저장 (뷰에 id 속성이 있을 때만 자동으로 수행)



**12.4.3 상태 복원**

상태가 저장된 Bundle 객체는 onCreate()와 onRestoreInstanceState() 두 콜백 메서드에서 모두 수신

- onCreate()
  - 상태를 복원하기 전에 Bundle이 null인지 확인
- onRestoreInstanceState()
  - 시스템이 복원할 데이터가 있을 때만 호출되므로 Bundle의 null 체크 X



#### 12.5 화면 회전 막기

매니페스트 파일에 Activity 태그 속성 중 screenOrientation 속성을 portrit(세로) / landscape(가로)로 설정

but, 안드로이드 누가(7.0) 버전부터 추가된 다중 창 기능 때문에 이 방법 소용없어짐



#### 12.6 다중 창 막기

다중 창 모드가 시작되고 해제될 때 액티비티의 생명주기에 따라 액티비티 재시작

다중 창 모드에서 현재 활성화된 창이 아닌 액티비티는 onPause() 상태로 일시정지, onStop()까지는 가지 않음

매니페스트의 <activity> or <application> 요소에서 resizeableActivity 속성을 추가하고 다중 창 기능 끌 수 있음 (default "true")